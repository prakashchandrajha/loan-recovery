<div class="flex h-screen bg-gray-50">
  <!-- Sidebar -->
  <aside class="w-64 bg-white border-r border-gray-200 hidden md:flex flex-col">
    <div class="p-6 border-b border-gray-200">
      <h1 class="text-xl font-bold text-gray-800">Division Panel</h1>
    </div>
    <nav class="flex-1 p-4 space-y-2">
      <button (click)="switchView('form')" [class.bg-blue-50]="currentView === 'form'"
        [class.text-blue-600]="currentView === 'form'"
        class="w-full flex items-center space-x-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors">
        <span>üìù</span>
        <span class="font-medium">New Entry</span>
      </button>

      <button (click)="switchView('list')" [class.bg-blue-50]="currentView === 'list'"
        [class.text-blue-600]="currentView === 'list'"
        class="w-full flex items-center space-x-3 px-4 py-3 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors">
        <span>üìã</span>
        <span class="font-medium">Records</span>
      </button>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 overflow-y-auto p-8">

    <!-- Mobile Header -->
    <div class="md:hidden mb-6 flex justify-between items-center">
      <h1 class="text-xl font-bold text-gray-800">Division Panel</h1>
      <div class="flex space-x-2">
        <button (click)="switchView('form')" class="p-2 bg-white rounded-lg border">üìù</button>
        <button (click)="switchView('list')" class="p-2 bg-white rounded-lg border">üìã</button>
      </div>
    </div>

    <!-- List View only, Form view is now the Modal -->
    <div *ngIf="currentView === 'list'" class="max-w-6xl mx-auto">
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <div class="p-6 border-b border-gray-200 flex justify-between items-center bg-gray-50">
          <h2 class="text-lg font-bold text-gray-800">Submitted Files</h2>
          <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
            Total: {{ entries.length }}
          </span>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead>
              <tr class="bg-gray-50 text-gray-600 text-sm uppercase tracking-wider">
                <th class="px-6 py-4 font-semibold border-b">File Details</th>
                <th class="px-6 py-4 font-semibold border-b">Status</th>
                <th class="px-6 py-4 font-semibold border-b w-1/3">Journey Log</th>
                <th class="px-6 py-4 font-semibold border-b text-right">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              <tr *ngFor="let entry of entries; let i = index" class="hover:bg-gray-50 transition-colors">
                <td class="px-6 py-4">
                  <div class="font-medium text-gray-800">{{ entry.fullName }}</div>
                  <div class="text-sm text-gray-500">{{ entry.mobileNumber }}</div>
                  <div class="mt-1">
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                      [class.bg-purple-100]="entry.sectionType === '13(2)'"
                      [class.text-purple-800]="entry.sectionType === '13(2)'"
                      [class.bg-indigo-100]="entry.sectionType === '13(4)'"
                      [class.text-indigo-800]="entry.sectionType === '13(4)'">
                      {{ entry.sectionType }}
                    </span>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                    [class.bg-green-100]="entry.status === 'Pending'"
                    [class.text-green-800]="entry.status === 'Pending'" [class.bg-red-100]="entry.status === 'Urgent'"
                    [class.text-red-800]="entry.status === 'Urgent'" [class.bg-yellow-100]="entry.status === 'Late'"
                    [class.text-yellow-800]="entry.status === 'Late'">
                    {{ entry.status }}
                  </span>
                  <!-- Deadline Display -->
                  <div class="mt-2 text-xs"
                    [ngClass]="{'text-red-600': isOverdue(entry), 'text-gray-500': !isOverdue(entry)}">
                    NPA Date: {{ entry.npaDate | date:'MMM d, y' }}
                    <span *ngIf="isOverdue(entry)" class="ml-1 font-medium">
                      (Overdue by {{ getDaysOverdue(entry) }} day{{ getDaysOverdue(entry) > 1 ? 's' : '' }})
                    </span>
                    <span *ngIf="!isOverdue(entry)" class="ml-1">
                      - Max allowed: {{ entry.deadlineDate | date:'MMM d, y' }}
                    </span>
                  </div>
                </td>
                <td class="px-6 py-4 text-sm text-gray-500">
                  <!-- NPA Date Field Display -->
                  <div *ngIf="entry.npaDate" class="mb-3 p-2 bg-gray-100 rounded text-xs">
                    <span class="font-medium text-gray-700">NPA Date:</span> {{ entry.npaDate }}
                  </div>
                  <!-- History Stack -->
                  <div class="space-y-3">
                    <div *ngFor="let log of entry.history" class="relative pl-3 border-l-2 border-gray-200"
                      [ngClass]="{'border-red-400': log.isLate, 'border-blue-400': log.location==='Division', 'border-purple-400': log.location==='Recovery', 'border-green-400': log.location==='Legal', 'border-orange-400': log.location.includes('Regional') || log.location === 'RODivision'}">
                      <div class="flex flex-col" [title]="log.action">
                        <span class="font-semibold text-xs text-gray-700">{{ log.location }}</span>
                        <span class="text-[10px] text-gray-400">{{ log.timestamp | date:'MMM d, h:mm a' }}</span>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 text-right space-x-2 align-top">

                  <!-- Only show actions if file is still in Division -->
                  <ng-container *ngIf="entry.currentLocation === 'Division'; else readOnlyActions">

                    <!-- Final Stage: Returned from RO with Valuation -->
                    <ng-container *ngIf="isReturnedFromRO(entry); else normalActions">
                      <ng-container *ngIf="!isFullyCompleted(entry); else completedActions">
                        <button (click)="openCompletionModal(entry)" title="Complete Process"
                          class="px-3 py-1.5 text-sm font-medium text-green-600 bg-green-50 hover:bg-green-100 rounded transition flex items-center space-x-1">
                          <span>üìù</span>
                          <span>Forward TO Recovery Division For Sale Notice</span>
                        </button>
                      </ng-container>
                      <ng-template #completedActions>
                        <span
                          class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-600 border border-green-200">
                          ‚úÖ Finalized
                        </span>
                      </ng-template>
                    </ng-container>

                    <!-- Normal Stage: New Entry -->
                    <ng-template #normalActions>
                      <!-- Actions (Standard) -->
                      <div class="flex space-x-2">
                        <button (click)="startHandover(entry)" class="text-blue-600 hover:text-blue-800" title="Edit">
                          ‚úèÔ∏è
                        </button>
                        <button (click)="deleteEntry(entry.id)" class="text-red-600 hover:text-red-800" title="Delete">
                          üóëÔ∏è
                        </button>
                        <button (click)="startHandover(entry)"
                          class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-medium hover:bg-green-200 transition">
                          Start Handover
                        </button>
                        <button (click)="markUrgent(entry.id)"
                          class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-medium hover:bg-red-200 transition">
                          Urgent Handover
                        </button>
                      </div>
                    </ng-template>

                  </ng-container>

                  <ng-template #readOnlyActions>
                    <span
                      class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-500 border border-gray-200">
                      üîí Transferred
                    </span>
                  </ng-template>

                </td>
              </tr>
              <tr *ngIf="entries.length === 0">
                <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                  <div class="flex flex-col items-center justify-center space-y-3">
                    <span class="text-4xl">üì≠</span>
                    <p>No files found. add a new file to get started.</p>
                    <button (click)="switchView('form')" class="text-blue-600 hover:underline text-sm">Create new
                      entry</button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- HANDOVER CHECKLIST FORM MODAL/OVERLAY -->
<div *ngIf="isHandoverMode" class="fixed inset-0 bg-gray-100 z-50 overflow-y-auto">
  <div class="max-w-7xl mx-auto p-8">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">Handover Checklist Document</h1>
        <p class="text-gray-600">File: {{ selectedEntryForHandover?.fullName || 'New Entry' }} | Division -> Recovery
          Cell</p>
      </div>
      <div class="space-x-3">
        <button (click)="cancelHandover()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
          Cancel
        </button>
        <button (click)="submitHandover(false)" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
          Forward to Recovery Cell
        </button>
      </div>
    </div>

    <!-- Section Navigation -->
    <div class="bg-white sticky top-0 z-40 shadow-sm border-b border-gray-200 mb-6 overflow-x-auto">
      <div class="flex space-x-1 p-2">
        <button *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14]" (click)="activeSection = i"
          [class.bg-blue-600]="activeSection === i" [class.text-white]="activeSection === i"
          [class.bg-gray-50]="activeSection !== i" [class.text-gray-600]="activeSection !== i"
          class="px-3 py-2 text-sm font-medium rounded whitespace-nowrap hover:bg-blue-50 transition-colors">
          {{ i }}. {{ ['Basic', 'Facility', 'Security', 'Valuation', 'Docs', 'Release', 'PDCs', 'Repay Original',
          'Restruct', 'Repay Revised', 'SARFAESI', 'Cases', 'Corres', 'Remarks'][i-1] }}
        </button>
      </div>
    </div>

    <div class="bg-white rounded-xl shadow-lg p-8 min-h-[500px]">

      <!-- 1. Basic Details -->
      <div *ngIf="activeSection === 1" class="space-y-6">
        <h2 class="text-xl font-bold border-b pb-2">1. Basic Details</h2>
        <div class="grid grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700">Name of Account</label>
            <input [(ngModel)]="handoverData.basicDetails.borrwerName" class="w-full mt-1 border rounded p-2"
              type="text">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Mobile Number</label>
            <input [(ngModel)]="handoverData.basicDetails.mobileNumber" class="w-full mt-1 border rounded p-2"
              type="text">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Date of Classification as NPA</label>
            <input [(ngModel)]="handoverData.basicDetails.classificationDate" class="w-full mt-1 border rounded p-2"
              type="date">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Business Activity</label>
            <input [(ngModel)]="handoverData.basicDetails.businessActivity" class="w-full mt-1 border rounded p-2"
              type="text">
          </div>
          <div class="col-span-2">
            <label class="block text-sm font-medium text-gray-700">Registered Address</label>
            <textarea [(ngModel)]="handoverData.basicDetails.registeredAddress" class="w-full mt-1 border rounded p-2"
              rows="2"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Factory Running?</label>
            <select [(ngModel)]="handoverData.basicDetails.isFactoryRunning" class="w-full mt-1 border rounded p-2">
              <option value="">Select</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
        </div>

        <!-- Directors Table -->
        <div class="mt-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Directors / Board Members</label>
          <table class="w-full border collapse text-sm">
            <thead class="bg-gray-50">
              <tr>
                <th class="border p-2">Name</th>
                <th class="border p-2">Designation</th>
                <th class="border p-2">Contact</th>
                <th class="border p-2">Address</th>
                <th class="border p-2 w-10"></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of handoverData.basicDetails.directors; let idx = index">
                <td class="border p-0"><input [(ngModel)]="d.name" class="w-full p-2 outline-none"></td>
                <td class="border p-0"><input [(ngModel)]="d.designation" class="w-full p-2 outline-none"></td>
                <td class="border p-0"><input [(ngModel)]="d.contact" class="w-full p-2 outline-none"></td>
                <td class="border p-0"><input [(ngModel)]="d.address" class="w-full p-2 outline-none"></td>
                <td class="border p-1 text-center"><button (click)="removeDirector(idx)" class="text-red-500">√ó</button>
                </td>
              </tr>
            </tbody>
          </table>
          <button (click)="addDirector()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Director</button>
        </div>
      </div>

      <!-- 2. Facility Sanctioned -->
      <div *ngIf="activeSection === 2">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">2. Facility Sanctioned</h2>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Facility Name</th>
              <th class="border p-2">Tenor</th>
              <th class="border p-2">Amount</th>
              <th class="border p-2">Sanction Date</th>
              <th class="border p-2 text-xs">O/S Amount</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let f of handoverData.facilities; let idx = index">
              <td class="border p-0"><input [(ngModel)]="f.name" class="w-full p-2 outline-none"
                  placeholder="e.g. Term Loan"></td>
              <td class="border p-0"><input [(ngModel)]="f.tenor" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="f.amount" type="number" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="f.sanctionDate" type="date" class="w-full p-2 outline-none">
              </td>
              <td class="border p-0"><input [(ngModel)]="f.outstandingAmount" type="number"
                  class="w-full p-2 outline-none"></td>
              <td class="border p-1 text-center"><button (click)="removeFacility(idx)" class="text-red-500">√ó</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button (click)="addFacility()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Facility</button>
      </div>

      <!-- 3. Details of Security -->
      <div *ngIf="activeSection === 3">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">3. Details of Security</h2>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Type</th>
              <th class="border p-2">Asset Type</th>
              <th class="border p-2">Address/Details</th>
              <th class="border p-2">Charge Type</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of handoverData.securities; let idx = index">
              <td class="border p-0"><input [(ngModel)]="s.type" class="w-full p-2 outline-none"
                  placeholder="Land/Stock"></td>
              <td class="border p-0"><input [(ngModel)]="s.assetType" class="w-full p-2 outline-none"
                  placeholder="Movable/Immovable"></td>
              <td class="border p-0"><input [(ngModel)]="s.address" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="s.chargeType" class="w-full p-2 outline-none"
                  placeholder="First/Pari-passu"></td>
              <td class="border p-1 text-center"><button (click)="removeSecurity(idx)" class="text-red-500">√ó</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button (click)="addSecurity()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Security</button>
      </div>

      <!-- 4. Valuation -->
      <div *ngIf="activeSection === 4">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">4. Valuation & Title Search</h2>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Security</th>
              <th class="border p-2">TSR Date</th>
              <th class="border p-2">Advocate</th>
              <th class="border p-2">Valuation Date</th>
              <th class="border p-2 text-xs">FMV</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let v of handoverData.valuations; let idx = index">
              <td class="border p-0"><input [(ngModel)]="v.security" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="v.titleSearchDate" type="date" class="w-full p-2 outline-none">
              </td>
              <td class="border p-0"><input [(ngModel)]="v.advocateName" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="v.valuationDate" type="date" class="w-full p-2 outline-none">
              </td>
              <td class="border p-0"><input [(ngModel)]="v.fmv" type="number" class="w-full p-2 outline-none"></td>
              <td class="border p-1 text-center"><button (click)="removeValuation(idx)" class="text-red-500">√ó</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button (click)="addValuation()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Valuation</button>
      </div>

      <!-- 5. Loan Documentation -->
      <div *ngIf="activeSection === 5">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">5. Loan Documentation</h2>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Facility</th>
              <th class="border p-2">Documents Executed (Date & Name)</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let d of handoverData.loanDocuments; let idx = index">
              <td class="border p-0 w-1/4"><input [(ngModel)]="d.facility" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><textarea [(ngModel)]="d.documentsExecuted" class="w-full p-2 outline-none"
                  rows="2"></textarea></td>
              <td class="border p-1 text-center"><button (click)="removeLoanDoc(idx)" class="text-red-500">√ó</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button (click)="addLoanDoc()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Document
          Details</button>
      </div>

      <!-- 6. Release Details -->
      <div *ngIf="activeSection === 6">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">6. Release Details</h2>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Date</th>
              <th class="border p-2">Against Release Letter</th>
              <th class="border p-2">Amount</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of handoverData.releases; let idx = index">
              <td class="border p-0"><input [(ngModel)]="r.date" type="date" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="r.againstLetter" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="r.amount" type="number" class="w-full p-2 outline-none"></td>
              <td class="border p-1 text-center"><button (click)="removeRelease(idx)" class="text-red-500">√ó</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button (click)="addRelease()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Release</button>
      </div>

      <!-- 7. PDC Details -->
      <div *ngIf="activeSection === 7" class="space-y-6">
        <h2 class="text-xl font-bold border-b pb-2">7. Post Dated Cheques (PDC)</h2>
        <div class="grid grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700">PDC Available?</label>
            <select [(ngModel)]="handoverData.pdcDetails.isAvailable" class="w-full mt-1 border rounded p-2">
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Number Available</label>
            <input [(ngModel)]="handoverData.pdcDetails.numberAvailable" type="number"
              class="w-full mt-1 border rounded p-2">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Section 138 Filed?</label>
            <select [(ngModel)]="handoverData.pdcDetails.isSection138Filed" class="w-full mt-1 border rounded p-2">
              <option value="">Select</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
          <div *ngIf="handoverData.pdcDetails.isSection138Filed === 'Yes'">
            <label class="block text-sm font-medium text-gray-700">Case No</label>
            <input [(ngModel)]="handoverData.pdcDetails.caseNo" type="text" class="w-full mt-1 border rounded p-2">
          </div>
        </div>
      </div>

      <!-- 8. Original Repayment Schedule -->
      <div *ngIf="activeSection === 8">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">8. Original Repayment Schedule</h2>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Installment Date</th>
              <th class="border p-2">Amount</th>
              <th class="border p-2">Actual Receipt Date</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of handoverData.originalRepaymentSchedule; let idx = index">
              <td class="border p-0"><input [(ngModel)]="s.installmentDate" type="date" class="w-full p-2 outline-none">
              </td>
              <td class="border p-0"><input [(ngModel)]="s.amount" type="number" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="s.receiptDate" type="date" class="w-full p-2 outline-none">
              </td>
              <td class="border p-1 text-center"><button (click)="removeOriginalRepayment(idx)"
                  class="text-red-500">√ó</button></td>
            </tr>
          </tbody>
        </table>
        <button (click)="addOriginalRepayment()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Row</button>
      </div>

      <!-- 9. Restructuring -->
      <div *ngIf="activeSection === 9" class="space-y-6">
        <h2 class="text-xl font-bold border-b pb-2">9. Restructuring</h2>
        <div>
          <label class="block text-sm font-medium text-gray-700">Restructuring Done?</label>
          <select [(ngModel)]="handoverData.restructuring.isDone" class="w-full mt-1 border rounded p-2">
            <option value="">Select</option>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>
        </div>
        <div *ngIf="handoverData.restructuring.isDone === 'Yes'" class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Date</label>
            <input [(ngModel)]="handoverData.restructuring.date" type="date" class="w-full mt-1 border rounded p-2">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Reference No</label>
            <input [(ngModel)]="handoverData.restructuring.refNo" type="text" class="w-full mt-1 border rounded p-2">
          </div>
        </div>
      </div>

      <!-- 10. Revised Repayment -->
      <div *ngIf="activeSection === 10">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">10. Revised Repayment Schedule</h2>
        <div *ngIf="handoverData.restructuring.isDone !== 'Yes'" class="text-gray-500 italic mb-4">Applicable only if
          restructuring was done.</div>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Installment Date</th>
              <th class="border p-2">Amount</th>
              <th class="border p-2">Actual Receipt Date</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of handoverData.revisedRepaymentSchedule; let idx = index">
              <td class="border p-0"><input [(ngModel)]="s.installmentDate" type="date" class="w-full p-2 outline-none">
              </td>
              <td class="border p-0"><input [(ngModel)]="s.amount" type="number" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="s.receiptDate" type="date" class="w-full p-2 outline-none">
              </td>
              <td class="border p-1 text-center"><button (click)="removeRevisedRepayment(idx)"
                  class="text-red-500">√ó</button></td>
            </tr>
          </tbody>
        </table>
        <button (click)="addRevisedRepayment()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Row</button>
      </div>

      <!-- 11. SARFAESI Action -->
      <div *ngIf="activeSection === 11" class="space-y-6">
        <h2 class="text-xl font-bold border-b pb-2">11. SARFAESI Action Taken</h2>
        <div class="grid grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700">Date of 13(2) Notice</label>
            <input [(ngModel)]="handoverData.sarfaesiAction.date132" type="date" class="w-full mt-1 border rounded p-2">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Date of 13(3) Reply</label>
            <input [(ngModel)]="handoverData.sarfaesiAction.date133Reply" type="date"
              class="w-full mt-1 border rounded p-2">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Date of 13(4) Notice</label>
            <input [(ngModel)]="handoverData.sarfaesiAction.date134" type="date" class="w-full mt-1 border rounded p-2">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Sale Notice Date</label>
            <input [(ngModel)]="handoverData.sarfaesiAction.saleNoticeDate" type="date"
              class="w-full mt-1 border rounded p-2">
          </div>
        </div>
      </div>

      <!-- 12. Legal Cases -->
      <div *ngIf="activeSection === 12">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">12. Pending Legal Cases</h2>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Borrower</th>
              <th class="border p-2">Case No</th>
              <th class="border p-2">NDOH</th>
              <th class="border p-2">Status</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of handoverData.legalCases; let idx = index">
              <td class="border p-0"><input [(ngModel)]="c.borrowerName" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="c.caseNo" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="c.ndoh" type="date" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="c.status" class="w-full p-2 outline-none"></td>
              <td class="border p-1 text-center"><button (click)="removeLegalCase(idx)" class="text-red-500">√ó</button>
              </td>
            </tr>
          </tbody>
        </table>
        <button (click)="addLegalCase()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Case</button>
      </div>

      <!-- 13. Correspondences -->
      <div *ngIf="activeSection === 13">
        <h2 class="text-xl font-bold border-b pb-2 mb-4">13. Correspondences</h2>
        <table class="w-full border collapse text-sm">
          <thead class="bg-gray-50">
            <tr>
              <th class="border p-2">Particulars (Email/Letter)</th>
              <th class="border p-2">Date</th>
              <th class="border p-2">Outcome/Remarks</th>
              <th class="border p-2 w-10"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of handoverData.correspondences; let idx = index">
              <td class="border p-0"><input [(ngModel)]="c.particulars" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="c.date" type="date" class="w-full p-2 outline-none"></td>
              <td class="border p-0"><input [(ngModel)]="c.outcome" class="w-full p-2 outline-none"></td>
              <td class="border p-1 text-center"><button (click)="removeCorrespondence(idx)"
                  class="text-red-500">√ó</button></td>
            </tr>
          </tbody>
        </table>
        <button (click)="addCorrespondence()" class="mt-2 text-sm text-blue-600 hover:underline">+ Add Row</button>
      </div>

      <!-- 14. Other Remarks -->
      <div *ngIf="activeSection === 14" class="space-y-6">
        <h2 class="text-xl font-bold border-b pb-2">14. Other Remarks</h2>
        <textarea [(ngModel)]="handoverData.otherRemarks" class="w-full border rounded p-4 h-40"
          placeholder="Any other relevant comments..."></textarea>
      </div>

      <div class="mt-8 flex justify-between">
        <button *ngIf="activeSection > 1" (click)="activeSection = activeSection - 1"
          class="px-4 py-2 border rounded hover:bg-gray-50">‚Üê Previous</button>
        <div *ngIf="activeSection < 14" class="flex-1"></div>
        <button *ngIf="activeSection < 14" (click)="activeSection = activeSection + 1"
          class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Next ‚Üí</button>
        <button *ngIf="activeSection === 14" (click)="submitHandover(false)"
          class="px-6 py-2 bg-green-600 text-white font-bold rounded hover:bg-green-700">Finish & Submit</button>
      </div>

    </div>
  </div>
</div>

<!-- Modal for Final completion (Minutes & Reserve Price) -->
<div *ngIf="selectedEntryForCompletion"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-xl max-w-lg w-full mx-4">
    <div class="p-6 border-b border-gray-200 flex justify-between items-center">
      <h3 class="text-lg font-bold text-gray-800">
        Final Process Completion
      </h3>
      <button (click)="closeCompletionModal()" class="text-gray-400 hover:text-gray-600">
        <span class="text-2xl">√ó</span>
      </button>
    </div>

    <div class="p-6">
      <div class="mb-4 bg-blue-50 p-4 rounded-lg">
        <h4 class="text-sm font-bold text-blue-800 mb-2">Valuation Details (From RO)</h4>
        <div class="text-sm text-blue-700">
          <p>Amount: ‚Çπ{{ selectedEntryForCompletion.valuationAmount?.toLocaleString('en-IN') }}</p>
          <p>File: {{ selectedEntryForCompletion.roValuationFileName }}</p>
        </div>
      </div>

      <!-- Reserve Price -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Reserve Price (‚Çπ) *</label>
        <input type="number" [(ngModel)]="reservePrice" placeholder="Enter Reserve Price" required
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-shadow" />
      </div>

      <!-- Minutes File Upload -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Upload Minutes Document *</label>
        <div class="relative">
          <input type="file" (change)="onMinutesFileSelected($event)" accept=".pdf,.doc,.docx"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-shadow" />
          <span class="absolute right-3 top-3.5 text-gray-400">üìé</span>
        </div>
        <div *ngIf="minutesFileName" class="mt-2 text-sm text-green-600">
          ‚úì Selected: {{ minutesFileName }}
        </div>
      </div>

      <!-- Actions -->
      <div class="flex space-x-3">
        <button (click)="submitCompletion()"
          class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 rounded-lg transition-colors flex justify-center items-center space-x-2">
          <span>üì§</span>
          <span>Send to Recovery Cell</span>
        </button>
        <button (click)="closeCompletionModal()"
          class="px-6 bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium py-3 rounded-lg transition-colors">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>